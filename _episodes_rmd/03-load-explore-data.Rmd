---
title: "Load and explore the data"
teaching: 15
exercises: 30
questions:
- "What data are required for eqtl mapping?"
objectives:
- To specify which input files are required for qtl2 and how they should be formatted.
keypoints:
- "QTL mapping data consists of a set of tables of data: marker genotypes, phenotypes, marker maps, etc."
source: Rmd
---

```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("03-")
```

We know that QTL mapping data consists of a set of tables of data: marker
genotypes, phenotypes, marker maps, etc. with the first column a set of IDs for the rows, and the first row is a set of IDs for the columns. 
Numeric phenotypes are separate from the often non-numeric covariates.

Load the tidyverse library.
```{r, load_tidyverse}
library(tidyverse)
```

```{r load_phenos}
# load the data
load("../data/pheno_clin_v6.RData")
```

```{r subset_phenos}
# subset the phenotypes to only those addressed in the paper
pheno2keep <- pheno_clin %>% 
  select(weight_14wk, weight_10wk, weight_6wk,
         Ins_14wk, Ins_10wk, Ins_6wk, Ins_per_islet, Ins_iAUC,
         HOMA_IR_0min, HOMA_B_0min,
         Glu_14wk, Glu_10wk, Glu_6wk, Glu_iAUC,
         TG_14wk, TG_10wk, TG_6wk,
         food_ave, WPIC, num_islets)
pheno_clin <- pheno_clin[,c(1:11, 166, 
                            which(colnames(pheno_clin) %in% names(pheno2keep)))]

# convert sex and DO wave (batch) to factors
pheno_clin$sex = factor(pheno_clin$sex)
pheno_clin$DOwave = factor(pheno_clin$DOwave)
```


> ## Challenge 1
> 1. Which data files are required by `qtl2`?  
> 2. Which ones are optional?  
> 3. How should they be formatted?
>
> > ## Solution to Challenge 1
> > 1. marker genotypes, phenotypes, genetic map
> > 2. physical map
> > 1. csv; JSON or YAML for control file
> {: .solution}
{: .challenge}

## Sample data sets

In this lesson, we'll work with data sets included in the `qtl2` package. You can find out more about the [sample data files](http://kbroman.org/qtl2/pages/sampledata.html) from the R/qtl2 web site. Zipped versions of these datasets are included with the [qtl2geno](https://github.com/rqtl/qtl2geno) package and can be loaded into R using the `read_cross2()` function.
Additional sample data sets, including data on Diversity Outbred (DO) mice, are available at <https://github.com/rqtl/qtl2data>.

> ## Challenge 2
> Go to <https://github.com/rqtl/qtl2data> to view additional sample data.  
> 1). Find the Recla data and locate the phenotype data file. Open the file by clicking on the file name. What is in the first column? the first row?  
> 2). Locate the genotype data file, click on the file name, and view the raw data. What is in the first column? the first row?  
> 3). Locate the covariates file and open it by clicking on the file name. What kind of information does this file contain?  
> 4). Locate the control file (YAML or JSON format) and open it. What kind of information does this file contain?  
>
> > ## Solution to Challenge 2
> >
> > 1). What is in the first column of the phenotype file? Animal ID. The first row? Phenotype variable names - OF_distance_first4, OF_distance, OF_corner_pct, OF_periphery_pct, ...  
> > 2). What is in the first column of the genotype file? marker ID. the first row? Animal ID - 1,4,5,6,7,8,9,10, ...  
> 3). Locate the covariates file and open it. What kind of information does this file contain? Animal ID, sex, cohort, group, subgroup, ngen, and coat color.  
> 4). Locate the control file (YAML or JSON format) and open it. What kind of information does this file contain? Names of primary data files, genotype and allele codes, cross type, description, and other metadata.
> {: .solution}
{: .challenge}


## Preparing your Diversity Outbred (DO) data for qtl2

Karl Broman provides detailed instructions for [preparing DO mouse data for R/qtl2](https://kbroman.org/qtl2/pages/prep_do_data.html).






